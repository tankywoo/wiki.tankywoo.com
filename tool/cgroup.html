<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>cgroup - Wiki · Tanky Woo</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, cpp, ops, simiki"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">Wiki · Tanky Woo</a>
    &nbsp;&#187;&nbsp;
    <a href="/#tool">tool</a>
    &nbsp;&#187;&nbsp;cgroup
    <span class="updated">最后更新&nbsp;
    2016-04-25 22:50
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">安装</a></li>
<li><a href="#_2">命令</a><ul>
<li><a href="#cgcreate">cgcreate</a></li>
<li><a href="#cgset">cgset</a></li>
<li><a href="#cgexec">cgexec</a></li>
<li><a href="#lscgroup">lscgroup</a></li>
<li><a href="#cgdelete">cgdelete</a></li>
<li><a href="#cgclear">cgclear</a></li>
</ul>
</li>
<li><a href="#_3">例子</a></li>
<li><a href="#todo">TODO</a></li>
<li><a href="#_4">参考</a></li>
</ul>
</div>
<p><code>Control Group</code>的简写。</p>
<blockquote>
<p>cgroups (abbreviated from control groups) is a Linux kernel feature that limits, accounts for, and isolates the resource usage (CPU, memory, disk I/O, network, etc.) of a collection of processes.</p>
</blockquote>
<p>(摘自<a href="https://en.wikipedia.org/wiki/Cgroups">维基百科</a>)</p>
<p>通过cgroups, 可以对cpu使用率、内存、网络带宽等资源进行控制(限额)。</p>
<h2 id="_1">安装</h2>
<p>首先需要保证内核开启了cgroups的支持。</p>
<p>Gentoo下:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">emerge</span> <span class="o">-</span><span class="n">auv</span> <span class="n">dev</span><span class="o">-</span><span class="n">libs</span><span class="o">/</span><span class="n">libcgroup</span>
</pre></div>


<p>安装的二进制工具:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">equery</span> <span class="n">files</span> <span class="n">libcgroup</span> <span class="o">|</span> <span class="n">grep</span> <span class="err">&#39;</span><span class="n">bin</span><span class="o">/</span><span class="err">&#39;</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgclassify</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgcreate</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgdelete</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgexec</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgget</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgset</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cgsnapshot</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lscgroup</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lssubsys</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">cgclear</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">cgconfigparser</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">cgrulesengd</span>
</pre></div>


<p>相应的控制器都会分别挂载上:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">mounts</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">cgroup</span>
<span class="n">cgroup_root</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span> <span class="n">tmpfs</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10240</span><span class="n">k</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">755</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">openrc</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">openrc</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">release_agent</span><span class="o">=/</span><span class="n">lib64</span><span class="o">/</span><span class="n">rc</span><span class="o">/</span><span class="n">sh</span><span class="o">/</span><span class="n">cgroup</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">agent</span><span class="p">.</span><span class="n">sh</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">openrc</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">cpuset</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpuset</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">cpuset</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">cpu</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpu</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">cpu</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">cpuacct</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpuacct</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">cpuacct</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">blkio</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">blkio</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">blkio</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">memory</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">memory</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">memory</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">devices</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">devices</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">devices</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">freezer</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">freezer</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">freezer</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">net_cls</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">net_cls</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">net_cls</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">perf_event</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">perf_event</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">perf_event</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">net_prio</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">net_prio</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">net_prio</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">hugetlb</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">hugetlb</span> <span class="n">cgroup</span> <span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">noexec</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">hugetlb</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>


<h2 id="_2">命令</h2>
<h3 id="cgcreate">cgcreate</h3>
<p>新建cgroup(s)，最简单是只使用<code>-g</code>参数:</p>
<div class="hlcode"><pre><span class="nx">cgcreate</span> <span class="na">-g</span> <span class="o">&lt;</span><span class="nx">controllers</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">path</span><span class="o">&gt;</span>
</pre></div>


<p>如:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cgcreate</span> <span class="o">-</span><span class="n">g</span> <span class="n">cpu</span><span class="o">:/</span><span class="n">cpulimited</span>
</pre></div>


<p>其中cpu是控制的类型, /cpulimited是相对于指定controller(这里是cpu)的cgroup的路径:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">tree</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpu</span><span class="o">/</span><span class="n">cpulimited</span>
<span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpu</span><span class="o">/</span><span class="n">cpulimited</span>
<span class="err">├──</span> <span class="n">cgroup</span><span class="p">.</span><span class="n">clone_children</span>
<span class="err">├──</span> <span class="n">cgroup</span><span class="p">.</span><span class="n">procs</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">cfs_period_us</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">cfs_quota_us</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">rt_period_us</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">rt_runtime_us</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">shares</span>
<span class="err">├──</span> <span class="n">cpu</span><span class="p">.</span><span class="n">stat</span>
<span class="err">├──</span> <span class="n">notify_on_release</span>
<span class="err">└──</span> <span class="n">tasks</span>

<span class="mi">0</span> <span class="n">directories</span><span class="p">,</span> <span class="mi">10</span> <span class="n">files</span>
</pre></div>


<h3 id="cgset">cgset</h3>
<p>配置指定cgroup(s)的参数:</p>
<div class="hlcode"><pre><span class="nx">cgset</span> <span class="err">[</span><span class="na">-r</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">=</span><span class="nb">value</span><span class="o">&gt;</span><span class="cp">]</span> <span class="nt">&lt;cgroup</span><span class="na">_path</span><span class="nt">&gt;</span>
</pre></div>


<p>如:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cgset</span> <span class="o">-</span><span class="n">r</span> <span class="n">cpu</span><span class="p">.</span><span class="n">shares</span><span class="o">=</span><span class="mi">512</span> <span class="n">cpulimited</span>
</pre></div>


<p>其中<code>cpu.shares</code>用于控制cpu的使用率，默认是1024，这里设置为其一般，则当其它资源也要使用全部的cpu时，会和这个控制组下的进程以2:1分配资源。</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cd</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">cgroup</span><span class="o">/</span><span class="n">cpu</span><span class="o">/</span><span class="n">cpulimited</span>
<span class="err">$</span> <span class="n">cat</span> <span class="n">cpu</span><span class="p">.</span><span class="n">shares</span>
<span class="mi">1024</span>
<span class="err">$</span> <span class="n">cgset</span> <span class="o">-</span><span class="n">r</span> <span class="n">cpu</span><span class="p">.</span><span class="n">shares</span><span class="o">=</span><span class="mi">512</span> <span class="n">cpulimited</span>
<span class="err">$</span> <span class="n">cat</span> <span class="n">cpu</span><span class="p">.</span><span class="n">shares</span>
<span class="mi">512</span>
</pre></div>


<h3 id="cgexec">cgexec</h3>
<p>在指定的cgroup(s)中执行任务:</p>
<div class="hlcode"><pre><span class="nx">cgexec</span> <span class="err">[</span><span class="na">-g</span> <span class="o">&lt;</span><span class="nx">controllers</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">path</span><span class="o">&gt;</span><span class="cp">]</span> command
</pre></div>


<p>如:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cgexec</span> <span class="o">-</span><span class="n">g</span> <span class="n">cpu</span><span class="o">:</span><span class="n">cpulimited</span> <span class="n">matho</span><span class="o">-</span><span class="n">primes</span> <span class="mi">0</span> <span class="mi">9999999999</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>


<p>这里<code>matho-primes</code>是质数生成器，用来CPU负载测试。</p>
<h3 id="lscgroup">lscgroup</h3>
<p>列出所有的cgroups。</p>
<p>本机上的结果:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">lscgroup</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">sshd</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">udev</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">nginx</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">samba</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">vixie</span><span class="o">-</span><span class="n">cron</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">rsyslog</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">lvmetad</span>
<span class="n">name</span><span class="o">=</span><span class="n">openrc</span><span class="o">:/</span><span class="n">svscan</span>
<span class="nl">cpuset:</span><span class="o">/</span>
<span class="nl">cpu:</span><span class="o">/</span>
<span class="nl">cpu:</span><span class="o">/</span><span class="n">cpulimited</span>    <span class="err">#</span> <span class="err">这个是先前手动建立的</span>
<span class="nl">cpuacct:</span><span class="o">/</span>
<span class="nl">blkio:</span><span class="o">/</span>
<span class="nl">memory:</span><span class="o">/</span>
<span class="nl">devices:</span><span class="o">/</span>
<span class="nl">freezer:</span><span class="o">/</span>
<span class="nl">net_cls:</span><span class="o">/</span>
<span class="nl">perf_event:</span><span class="o">/</span>
<span class="nl">net_prio:</span><span class="o">/</span>
<span class="nl">hugetlb:</span><span class="o">/</span>
</pre></div>


<p>TODO: 其它是内置的?</p>
<h3 id="cgdelete">cgdelete</h3>
<p>删除指定的cgroup(s)。</p>
<div class="hlcode"><pre><span class="nx">cgdelete</span> <span class="err">[[</span><span class="na">-g</span><span class="cp">]</span> <span class="nt">&lt;controllers&gt;</span>:<span class="nt">&lt;path&gt;</span>]
</pre></div>


<p>没指定<code>&lt;controllers&gt;:&lt;path&gt;</code>则会删除所有自定义添加的；<code>-g</code>可写可不写:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cgdelete</span> <span class="n">cpu</span><span class="o">:/</span><span class="n">cpulimited</span>
</pre></div>


<p>可以通过<code>lscgroup</code>来确认。</p>
<h3 id="cgclear">cgclear</h3>
<p>卸载cgroup文件系统</p>
<h2 id="_3">例子</h2>
<p>基于上面的配置，在控制组下只运行一个matho-primes进程时，cpu占用率是100%:</p>
<div class="hlcode"><pre> <span class="n">PID</span> <span class="n">USER</span>      <span class="n">PRI</span>  <span class="n">NI</span>  <span class="n">VIRT</span>   <span class="n">RES</span>   <span class="n">SHR</span> <span class="n">S</span> <span class="n">CPU</span><span class="o">%</span> <span class="n">MEM</span><span class="o">%</span>   <span class="n">TIME</span><span class="o">+</span>  <span class="n">Command</span>
<span class="mi">6375</span> <span class="n">root</span>       <span class="mi">20</span>   <span class="mi">0</span>  <span class="mi">9080</span>  <span class="mi">3344</span>  <span class="mi">1456</span> <span class="n">R</span> <span class="mf">100.</span>  <span class="mf">0.2</span>  <span class="mi">0</span><span class="o">:</span><span class="mf">13.20</span> <span class="n">matho</span><span class="o">-</span><span class="n">primes</span> <span class="mi">0</span> <span class="mi">9999999999</span>
</pre></div>


<p>然后额外运行一个matho-primes进程(非cgroup下):</p>
<div class="hlcode"><pre> <span class="n">PID</span> <span class="n">USER</span>      <span class="n">PRI</span>  <span class="n">NI</span>  <span class="n">VIRT</span>   <span class="n">RES</span>   <span class="n">SHR</span> <span class="n">S</span> <span class="n">CPU</span><span class="o">%</span> <span class="n">MEM</span><span class="o">%</span>   <span class="n">TIME</span><span class="o">+</span>  <span class="n">Command</span>
<span class="mi">6761</span> <span class="n">root</span>       <span class="mi">20</span>   <span class="mi">0</span>  <span class="mi">9080</span>  <span class="mi">3240</span>  <span class="mi">1344</span> <span class="n">R</span> <span class="mf">67.0</span>  <span class="mf">0.2</span>  <span class="mi">0</span><span class="o">:</span><span class="mf">03.16</span> <span class="n">matho</span><span class="o">-</span><span class="n">primes</span> <span class="mi">0</span> <span class="mi">9999999999</span>
<span class="mi">6375</span> <span class="n">root</span>       <span class="mi">20</span>   <span class="mi">0</span>  <span class="mi">9080</span>  <span class="mi">3344</span>  <span class="mi">1456</span> <span class="n">R</span> <span class="mf">33.0</span>  <span class="mf">0.2</span>  <span class="mi">2</span><span class="o">:</span><span class="mf">15.17</span> <span class="n">matho</span><span class="o">-</span><span class="n">primes</span> <span class="mi">0</span> <span class="mi">9999999999</span>
</pre></div>


<p>可以看到，新开的进程(pid 6761)的cpu使用率是前者的两倍。</p>
<h2 id="todo">TODO</h2>
<p>通过<code>cgclear</code>卸载文件系统后，如果不重启的情况下恢复？</p>
<div class="hlcode"><pre><span class="n">service</span> <span class="n">cgconfig</span> <span class="n">start</span>
</pre></div>


<p>未解决问题。</p>
<p>看是inittab有控制cgroup。</p>
<p>另外/etc/配置文件这块需要了解。</p>
<h2 id="_4">参考</h2>
<ul>
<li><a href="http://blog.scoutapp.com/articles/2014/11/04/restricting-process-cpu-usage-using-nice-cpulimit-and-cgroups">RESTRICTING PROCESS CPU USAGE USING NICE, CPULIMIT, AND CGROUPS</a></li>
<li><a href="https://linux.cn/article-4742-1.html">使用 nice、cpulimit 和 cgroups 限制 cpu 占用率</a> 上面的翻译版</li>
<li><a href="http://coolshell.cn/articles/17049.html">Docker基础技术：Linux CGroup</a></li>
<li><a href="https://www.cloudsigma.com/howto-cgroups/">HowTo: CGroups</a></li>
<li><a href="http://superuser.com/questions/921086/how-to-limit-cpu-consumtion-of-a-process-group-with-standard-gnu-linux-tools">How to limit CPU consumtion of a process group with standard GNU/Linux tools?</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-limit-cpu-usage-on-ubuntu-12-10">How To Limit CPU Usage On Ubuntu 12.10</a></li>
<li><a href="https://github.com/opsengine/cpulimit">cpulimit</a></li>
<li><a href="https://linuxtoy.org/archives/cpulimit.html">cpulimit: 限制进程的 CPU 占用率</a></li>
<li><a href="http://stackoverflow.com/questions/2925606/how-to-create-a-cpu-spike-with-a-bash-command">How to create a CPU spike with a bash command</a></li>
</ul>
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2012-2016 Tanky Woo.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
        <p>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>站点最后生成 2016-05-10 22:44:57</p>
        <p><a href="https://github.com/tankywoo/wiki.tankywoo.com">Fork me on Github</a></p>
        <p><a href="http://www.miitbeian.gov.cn/">京ICP备16016622号</a></p>
      </div> <!-- end footer-right -->
    </div>
    <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
    </script>
  </body>
</html>